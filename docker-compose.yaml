version: "3.8"
services:

  # IDE in browser
  ide:
    build:
      context: .
      target: ide
    image: writing_quality_prediction_dev_image
    container_name: writing_quality_prediction_dev
    ports:
      - 8123:8123
      - 8080:8080
      - 40000:40000
    volumes:
      - .:/home/root/app
      - pre-commit:/root/.cache/pre-commit
      - poetry-cache:/root/.cache/pypoetry
      - $HOME/.gitconfig:/root/.gitconfig
      - /run/host-services/ssh-auth.sock:/run/host-services/ssh-auth.sock
    #  - $SSH_AUTH_SOCK:/tmp/authsock
    environment:
    #  SSH_AUTH_SOCK: /tmp/authsock
      SSH_AUTH_SOCK: /ssh-agent
    env_file:
      - .env_dev
    restart: unless-stopped
    command: "code-server --auth none --bind-addr 0.0.0.0:8123 /home/root/app"
    tty: true

  prod:
    build:
      context: .
      target: prod
    image: writing_quality_prediction_prod_image
    container_name: writing_quality_prediction_prod
    command: /bin/bash
    tty: true

volumes:
  vscode-extensions:
  pre-commit:
  poetry-cache: